import{S as Q,a as U}from"./chunk-RNCCSLPH-CNBXu2wL.js";import{Q as W,j as e,q as G,d as Z,R as X,a as $,S as ee,p as te,s as se,b as v,H as N,A as b,u as E,f as ae,r as C,U as ie,m as F,V as z,L as q,T as _,B as ne,W as re,Y as K,J as le,Z as oe,_ as J,$ as ce,a0 as de,k as ue}from"./index-DkzW1lbC.js";import{g as me}from"./chunk-OIAPXGI2-Bh86W0RV.js";import{P as pe}from"./chunk-AM2BU2RH-Jz_rw4zs.js";import{S as x}from"./chunk-LFLGEXIG-Ce1Gjd4x.js";import{T as B}from"./chunk-2RQLKDBF-CSGx1hXH.js";import{u as xe}from"./chunk-JGKUKVRC-96n9KjXI.js";import{D as he,u as fe,c as ve,a as ge}from"./chunk-FPVDKY3X-DRU-UCu7.js";import{u as je}from"./chunk-C76H5USB-C8KApNCG.js";import{P as O}from"./chunk-ZVVQK46Y-BRmCbG4g.js";import{P as y}from"./pencil-square-C-rPDm7p.js";import{S as ye}from"./status-badge-DVDUCAEw.js";import{T as M}from"./trash-DsE5_8XG.js";import{T as be}from"./thumbnail-badge-2kwfZ9B-.js";import{C as Se}from"./channels-DIGo5VZC.js";import{T as we}from"./Trans-kjzLiaOB.js";import{C as H}from"./component-Dz_bxioB.js";import{u as L}from"./use-prompt-PSNAYpzK.js";import{c as Ce}from"./create-data-table-command-helper-C3wntDfO.js";import{C as S}from"./container-CcEbOgD_.js";import{C as Ne}from"./checkbox-meFL0Q5O.js";import{C as D}from"./command-bar-CzjD0zPo.js";import"./chunk-EQTBJSBZ-Dck6qwSx.js";import"./x-mark-mini-bZP8SCsT.js";import"./check-Cp4AC2Hf.js";import"./chunk-BKWQ2FHJ-QjmO9jF9.js";import"./format-ncaUJPf-.js";import"./index-C80j_Nkx.js";import"./table-yxlhz450.js";import"./arrow-up-mini-U4e2cj7E.js";import"./date-picker-q6BpD6Yt.js";import"./popover-CkT8s_eK.js";import"./index-CrLI-CUR.js";import"./triangle-left-mini-C63wDOBG.js";import"./prompt-PHMJs5xL.js";var wt=s=>{const{id:t}=s.params||{},{product:a}=W(t,{fields:O},{initialData:s.data,enabled:!!t});return a?e.jsx("span",{children:a.title}):null},_e=s=>({queryKey:te.detail(s,{fields:O}),queryFn:async()=>se.admin.product.retrieve(s,{fields:O})}),Ct=async({params:s})=>{const t=s.id,a=_e(t);return await G.ensureQueryData({...a,staleTime:9e4})},ke=({product:s})=>{const{t}=v(),{getDisplays:a}=$();return e.jsxs(S,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(N,{level:"h2",children:t("products.attributes")}),e.jsx(b,{groups:[{actions:[{label:t("actions.edit"),to:"attributes",icon:e.jsx(y,{})}]}]})]}),e.jsx(x,{title:t("fields.height"),value:s.height}),e.jsx(x,{title:t("fields.width"),value:s.width}),e.jsx(x,{title:t("fields.length"),value:s.length}),e.jsx(x,{title:t("fields.weight"),value:s.weight}),e.jsx(x,{title:t("fields.midCode"),value:s.mid_code}),e.jsx(x,{title:t("fields.hsCode"),value:s.hs_code}),e.jsx(x,{title:t("fields.countryOfOrigin"),value:me(s.origin_country)}),a("product","attributes").map((i,r)=>e.jsx(i,{data:s},r))]})},Te=s=>{switch(s){case"draft":return"grey";case"proposed":return"orange";case"published":return"green";case"rejected":return"red";default:return"grey"}},De=({product:s})=>{const{t}=v(),a=L(),i=E(),{getDisplays:r}=$(),n=r("product","general"),{mutateAsync:d}=ae(s.id),m=async()=>{await a({title:t("general.areYouSure"),description:t("products.deleteWarning",{title:s.title}),confirmText:t("actions.delete"),cancelText:t("actions.cancel")})&&await d(void 0,{onSuccess:()=>{i("..")}})};return e.jsxs(S,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(N,{children:s.title}),e.jsxs("div",{className:"flex items-center gap-x-4",children:[e.jsx(ye,{color:Te(s.status),children:t(`products.productStatus.${s.status}`)}),e.jsx(b,{groups:[{actions:[{label:t("actions.edit"),to:"edit",icon:e.jsx(y,{})}]},{actions:[{label:t("actions.delete"),onClick:m,icon:e.jsx(M,{})}]}]})]})]}),e.jsx(x,{title:t("fields.description"),value:s.description}),e.jsx(x,{title:t("fields.subtitle"),value:s.subtitle}),e.jsx(x,{title:t("fields.handle"),value:`/${s.handle}`}),e.jsx(x,{title:t("fields.discountable"),value:s.discountable?t("fields.true"):t("fields.false")}),n.map((h,o)=>e.jsx(h,{data:s},o))]})},Pe=({product:s})=>{const{t}=v(),a=L(),[i,r]=C.useState({}),n=ze(s),d=o=>{r(l=>{if(l[o]){const{[o]:u,...c}=l;return c}else return{...l,[o]:!0}})},{mutateAsync:m}=ie(s.id),h=async()=>{const o=Object.keys(i),l=o.some(p=>{var g;return(g=n.find(j=>j.id===p))==null?void 0:g.isThumbnail});if(!await a({title:t("general.areYouSure"),description:l?t("products.media.deleteWarningWithThumbnail",{count:o.length}):t("products.media.deleteWarning",{count:o.length}),confirmText:t("actions.delete"),cancelText:t("actions.cancel")}))return;const c=s.images.filter(p=>!o.includes(p.id)).map(p=>({url:p.url}));await m({images:c,thumbnail:l?"":void 0},{onSuccess:()=>{r({})}})};return e.jsxs(S,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(N,{level:"h2",children:t("products.media.label")}),e.jsx(b,{groups:[{actions:[{label:t("actions.edit"),to:"media?view=edit",icon:e.jsx(y,{})}]}]})]}),n.length>0?e.jsx("div",{className:"grid grid-cols-[repeat(auto-fill,minmax(96px,1fr))] gap-4 px-6 py-4",children:n.map((o,l)=>{const u=i[o.id];return e.jsxs("div",{className:"shadow-elevation-card-rest hover:shadow-elevation-card-hover transition-fg group relative aspect-square size-full cursor-pointer overflow-hidden rounded-[8px]",children:[e.jsx("div",{className:F("transition-fg invisible absolute right-2 top-2 opacity-0 group-hover:visible group-hover:opacity-100",{"visible opacity-100":u}),children:e.jsx(Ne,{checked:i[o.id]||!1,onCheckedChange:()=>d(o.id)})}),o.isThumbnail&&e.jsx("div",{className:"absolute left-2 top-2",children:e.jsx(z,{content:t("fields.thumbnail"),children:e.jsx(be,{})})}),e.jsx(q,{to:"media",state:{curr:l},children:e.jsx("img",{src:o.url,alt:`${s.title} image`,className:"size-full object-cover"})})]},o.id)})}):e.jsxs("div",{className:"flex flex-col items-center gap-y-4 pb-8 pt-6",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(_,{size:"small",leading:"compact",weight:"plus",className:"text-ui-fg-subtle",children:t("products.media.emptyState.header")}),e.jsx(_,{size:"small",className:"text-ui-fg-muted",children:t("products.media.emptyState.description")})]}),e.jsx(ne,{size:"small",variant:"secondary",asChild:!0,children:e.jsx(q,{to:"media?view=edit",children:t("products.media.emptyState.action")})})]}),e.jsx(D,{open:!!Object.keys(i).length,children:e.jsxs(D.Bar,{children:[e.jsx(D.Value,{children:t("general.countSelected",{count:Object.keys(i).length})}),e.jsx(D.Seperator,{}),e.jsx(D.Command,{action:h,label:t("actions.delete"),shortcut:"d"})]})})]})},ze=s=>{const{images:t=[],thumbnail:a}=s,i=t.map(r=>({id:r.id,url:r.url,isThumbnail:r.url===a}));return a&&!i.some(r=>r.url===a)&&i.unshift({id:"img_thumbnail",url:a,isThumbnail:!0}),i},Ae=({product:s,option:t})=>{const{t:a}=v(),{mutateAsync:i}=de(s.id,t.id),r=L(),n=async()=>{await r({title:a("general.areYouSure"),description:a("products.options.deleteWarning",{title:t.title}),confirmText:a("actions.delete"),cancelText:a("actions.cancel")})&&await i()};return e.jsx(b,{groups:[{actions:[{label:a("actions.edit"),to:`options/${t.id}/edit`,icon:e.jsx(y,{})}]},{actions:[{label:a("actions.delete"),onClick:n,icon:e.jsx(M,{})}]}]})},Ie=({product:s})=>{var a;const{t}=v();return e.jsxs(S,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(N,{level:"h2",children:t("products.options.header")}),e.jsx(b,{groups:[{actions:[{label:t("actions.create"),to:"options/create",icon:e.jsx(re,{})}]}]})]}),(a=s.options)==null?void 0:a.map(i=>{var r;return e.jsx(x,{title:i.title,value:(r=i.values)==null?void 0:r.map(n=>e.jsx(K,{size:"2xsmall",className:"flex min-w-[20px] items-center justify-center",children:n.value},n.value)),actions:e.jsx(Ae,{product:s,option:i})},i.id)})]})},Oe=({product:s})=>{var i,r;const{t}=v(),{getDisplays:a}=$();return e.jsxs(S,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(N,{level:"h2",children:t("products.organization.header")}),e.jsx(b,{groups:[{actions:[{label:t("actions.edit"),to:"organization",icon:e.jsx(y,{})}]}]})]}),e.jsx(x,{title:t("fields.tags"),value:(i=s.tags)!=null&&i.length?s.tags.map(n=>e.jsx(I,{label:n.value,to:`/settings/product-tags/${n.id}`},n.id)):void 0}),e.jsx(x,{title:t("fields.type"),value:s.type?e.jsx(I,{label:s.type.value,to:`/settings/product-types/${s.type_id}`}):void 0}),e.jsx(x,{title:t("fields.collection"),value:s.collection?e.jsx(I,{label:s.collection.title,to:`/collections/${s.collection.id}`}):void 0}),e.jsx(x,{title:t("fields.categories"),value:(r=s.categories)!=null&&r.length?s.categories.map(n=>e.jsx(I,{label:n.name,to:`/categories/${n.id}`},n.id)):void 0}),a("product","organize").map((n,d)=>e.jsx(n,{data:s},d))]})},I=({label:s,to:t})=>e.jsx(z,{content:s,children:e.jsx(K,{size:"2xsmall",className:"block w-fit truncate",asChild:!0,children:e.jsx(q,{to:t,children:s})})}),$e=({product:s})=>{var d;const{count:t}=le(),{t:a}=v(),i=((d=s.sales_channels)==null?void 0:d.map(m=>({id:m.id,name:m.name})))??[],r=i.slice(0,3),n=i.slice(3);return e.jsxs(S,{className:"flex flex-col gap-y-4 px-6 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(N,{level:"h2",children:a("fields.sales_channels")}),e.jsx(b,{groups:[{actions:[{label:a("actions.edit"),to:"sales-channels",icon:e.jsx(y,{})}]}]})]}),e.jsxs("div",{className:"grid grid-cols-[28px_1fr] items-center gap-x-3",children:[e.jsx("div",{className:"bg-ui-bg-base shadow-borders-base flex size-7 items-center justify-center rounded-md",children:e.jsx("div",{className:"bg-ui-bg-component flex size-6 items-center justify-center rounded-[4px]",children:e.jsx(Se,{className:"text-ui-fg-subtle"})})}),i.length>0?e.jsxs("div",{className:"flex items-center gap-x-1",children:[e.jsx(_,{size:"small",leading:"compact",children:r.map(m=>m.name).join(", ")}),n.length>0&&e.jsx(z,{content:e.jsx("ul",{children:n.map(m=>e.jsx("li",{children:m.name},m.id))}),children:e.jsx(_,{size:"small",leading:"compact",className:"text-ui-fg-subtle",children:`+${n.length}`})})]}):e.jsx(_,{size:"small",leading:"compact",className:"text-ui-fg-subtle",children:a("products.noSalesChannels")})]}),e.jsx("div",{children:e.jsx(_,{className:"text-ui-fg-subtle",size:"small",leading:"compact",children:e.jsx(we,{i18nKey:"sales_channels.availableIn",values:{x:i.length,y:t??0},components:[e.jsx("span",{className:"text-ui-fg-base txt-compact-medium-plus"},"x"),e.jsx("span",{className:"text-ui-fg-base txt-compact-medium-plus"},"y")]})})})]})},R=10,Le=({product:s})=>{const{t}=v(),{q:a,order:i,offset:r,allow_backorder:n,manage_inventory:d,created_at:m,updated_at:h}=je(["q","order","offset","manage_inventory","allow_backorder","created_at","updated_at"]),o=Be(s),l=qe(),u=Ke(),{variants:c,count:p,isPending:g,isError:j,error:w}=oe(s.id,{q:a,order:i||"variant_rank",offset:r?parseInt(r):void 0,limit:R,allow_backorder:n?JSON.parse(n):void 0,manage_inventory:d?JSON.parse(d):void 0,created_at:m?JSON.parse(m):void 0,updated_at:h?JSON.parse(h):void 0,fields:"*inventory_items.inventory.location_levels,+inventory_quantity"},{placeholderData:ue});if(j)throw w;return e.jsx(S,{className:"divide-y p-0",children:e.jsx(he,{data:c,columns:o,filters:l,rowCount:p,getRowId:f=>f.id,rowHref:f=>`/products/${s.id}/variants/${f.id}`,pageSize:R,isLoading:g,heading:t("products.variants.header"),emptyState:{empty:{heading:t("products.variants.empty.heading"),description:t("products.variants.empty.description")},filtered:{heading:t("products.variants.filtered.heading"),description:t("products.variants.filtered.description")}},action:{label:t("actions.create"),to:"variants/create"},actionMenu:{groups:[{actions:[{label:t("products.editPrices"),to:"prices",icon:e.jsx(y,{})},{label:t("inventory.stock.action"),to:"stock",icon:e.jsx(J,{})}]}]},commands:u})})},P=ve(),Be=s=>{const{t}=v(),a=E(),{mutateAsync:i}=ce(s.id),r=L(),n=xe(),d=C.useCallback(async(l,u)=>{await r({title:t("general.areYouSure"),description:t("products.deleteVariantWarning",{title:u}),confirmText:t("actions.delete"),cancelText:t("actions.cancel")})&&await i({variantId:l})},[i,r,t]),m=C.useMemo(()=>s!=null&&s.options?s.options.map(l=>P.display({id:l.id,header:l.title,cell:({row:u})=>{var p;const c=(p=u.original.options)==null?void 0:p.find(g=>g.option_id===l.id);return c?e.jsx("div",{className:"flex items-center",children:e.jsx(z,{content:c.value,children:e.jsx(K,{size:"2xsmall",title:c.value,className:"inline-flex min-w-[20px] max-w-[140px] items-center justify-center overflow-hidden truncate",children:c.value})})}):e.jsx("span",{className:"text-ui-fg-muted",children:"-"})}})):[],[s]),h=C.useCallback(l=>{var j,w;const u=l.row.original,c=[{icon:e.jsx(y,{}),label:t("actions.edit"),onClick:f=>{a(`edit-variant?variant_id=${f.row.original.id}`)}}],p=[{icon:e.jsx(M,{}),label:t("actions.delete"),onClick:()=>d(u.id,u.title)}];switch(((j=u.inventory_items)==null?void 0:j.length)||0){case 0:break;case 1:{const f=`/inventory/${u.inventory_items[0].inventory.id}`;c.push({label:t("products.variant.inventory.actions.inventoryItems"),onClick:()=>{a(f)},icon:e.jsx(J,{})});break}default:{const f=(w=u.inventory_items)==null?void 0:w.map(k=>{var T;return(T=k.inventory)==null?void 0:T.id});if(!f||f.length===0)break;const A=`/inventory?${new URLSearchParams({id:f.join(",")}).toString()}`;c.push({label:t("products.variant.inventory.actions.inventoryKit"),onClick:()=>{a(A)},icon:e.jsx(H,{})})}}return[c,p]},[d,a,t]),o=C.useCallback(l=>{var A;const u=l,c=l.inventory_quantity,p=(A=u.inventory_items)==null?void 0:A.map(k=>k.inventory).filter(Boolean),g=p.length>1,j={};p.forEach(k=>{var T;(T=k.location_levels)==null||T.forEach(Y=>{j[Y.id]=!0})});const w=Object.keys(j).length;return{text:g?t("products.variant.tableItemAvailable",{availableCount:c}):t("products.variant.tableItem",{availableCount:c,locationCount:w,count:w}),hasInventoryKit:g,quantity:c}},[t]);return C.useMemo(()=>[P.accessor("title",{header:t("fields.title"),enableSorting:!0,sortAscLabel:t("filters.sorting.alphabeticallyAsc"),sortDescLabel:t("filters.sorting.alphabeticallyDesc")}),P.accessor("sku",{header:t("fields.sku"),enableSorting:!0,sortAscLabel:t("filters.sorting.alphabeticallyAsc"),sortDescLabel:t("filters.sorting.alphabeticallyDesc")}),...m,P.display({id:"inventory",header:t("fields.inventory"),cell:({row:l})=>{const{text:u,hasInventoryKit:c,quantity:p}=o(l.original);return e.jsx(z,{content:u,children:e.jsxs("div",{className:"flex h-full w-full items-center gap-2 overflow-hidden",children:[c&&e.jsx(H,{}),e.jsx("span",{className:F("truncate",{"text-ui-fg-error":!p}),children:u})]})})},maxSize:250}),...n,P.action({actions:h})],[t,m,n,h,o])},V=ge(),qe=()=>{const{t:s}=v(),t=fe();return C.useMemo(()=>[V.accessor("allow_backorder",{type:"radio",label:s("fields.allowBackorder"),options:[{label:s("filters.radio.yes"),value:"true"},{label:s("filters.radio.no"),value:"false"}]}),V.accessor("manage_inventory",{type:"radio",label:s("fields.manageInventory"),options:[{label:s("filters.radio.yes"),value:"true"},{label:s("filters.radio.no"),value:"false"}]}),...t],[s,t])},Ee=Ce(),Ke=()=>{const{t:s}=v(),t=E();return[Ee.command({label:s("inventory.stock.action"),shortcut:"i",action:async a=>{t(`stock?${pe}=${Object.keys(a).join(",")}`)}})]},Me=({product:s})=>{const{t}=v(),a=s.shipping_profile;return e.jsxs(S,{className:"p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(N,{level:"h2",children:t("products.shippingProfile.header")}),e.jsx(b,{groups:[{actions:[{label:t("actions.edit"),to:"shipping-profile",icon:e.jsx(y,{})}]}]})]}),a&&e.jsx(Q,{to:`/settings/locations/shipping-profiles/${a.id}`,labelKey:a.name,descriptionKey:a.type,icon:e.jsx(U,{})})]})},Nt=()=>{const s=Z(),{id:t}=X(),{product:a,isLoading:i,isError:r,error:n}=W(t,{fields:O},{initialData:s}),{getWidgets:d}=$(),m=d("product.details.after"),h=d("product.details.before"),o=d("product.details.side.after"),l=d("product.details.side.before");if(i||!a)return e.jsx(ee,{mainSections:4,sidebarSections:3,showJSON:!0,showMetadata:!0});if(r)throw n;return e.jsxs(B,{widgets:{after:m,before:h,sideAfter:o,sideBefore:l},showJSON:!0,showMetadata:!0,data:a,children:[e.jsxs(B.Main,{children:[e.jsx(De,{product:a}),e.jsx(Pe,{product:a}),e.jsx(Ie,{product:a}),e.jsx(Le,{product:a})]}),e.jsxs(B.Sidebar,{children:[e.jsx($e,{product:a}),e.jsx(Me,{product:a}),e.jsx(Oe,{product:a}),e.jsx(ke,{product:a})]})]})};export{wt as Breadcrumb,Nt as Component,Ct as loader};
