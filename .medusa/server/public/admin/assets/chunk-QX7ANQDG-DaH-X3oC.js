import{r as b,a5 as p,j as e,m as w,b as O,H as V,a8 as L,a9 as z,t as R,y as H,cq as K,w as x,bu as m,I as U,G,B as A,az as y}from"./index-DkzW1lbC.js";import{K as $}from"./chunk-6HTZNHPT-BAw8hsS0.js";import{b as d,u as Y}from"./chunk-AYRG2MQL-p8d_KfEl.js";import{A as q,a as J}from"./arrow-up-mini-U4e2cj7E.js";import{T as Q}from"./trash-DsE5_8XG.js";var W=Object.defineProperty,h=Object.getOwnPropertySymbols,C=Object.prototype.hasOwnProperty,M=Object.prototype.propertyIsEnumerable,I=(t,s,l)=>s in t?W(t,s,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[s]=l,X=(t,s)=>{for(var l in s)C.call(s,l)&&I(t,l,s[l]);if(h)for(var l of h(s))M.call(s,l)&&I(t,l,s[l]);return t},Z=(t,s)=>{var l={};for(var a in t)C.call(t,a)&&s.indexOf(a)<0&&(l[a]=t[a]);if(t!=null&&h)for(var a of h(t))s.indexOf(a)<0&&M.call(t,a)&&(l[a]=t[a]);return l};const S=b.forwardRef((t,s)=>{var l=t,{color:a="currentColor"}=l,u=Z(l,["color"]);return b.createElement("svg",X({xmlns:"http://www.w3.org/2000/svg",width:15,height:15,fill:"none",ref:s},u),b.createElement("path",{fill:a,fillRule:"evenodd",d:"M6.306 7.5a1.194 1.194 0 1 1 2.389 0 1.194 1.194 0 0 1-2.39 0M6.306 2.389a1.194 1.194 0 1 1 2.389 0 1.194 1.194 0 0 1-2.39 0M6.306 12.611a1.194 1.194 0 1 1 2.388 0 1.194 1.194 0 0 1-2.388 0",clipRule:"evenodd"}))});S.displayName="EllipsisVertical";var ee=p.object({key:p.string(),disabled:p.boolean().optional(),value:p.any()}),ae=p.object({metadata:p.array(ee)}),me=t=>{const{t:s}=O(),{isPending:l,...a}=t;return e.jsxs(d,{children:[e.jsxs(d.Header,{children:[e.jsx(d.Title,{asChild:!0,children:e.jsx(V,{children:s("metadata.edit.header")})}),e.jsx(d.Description,{className:"sr-only",children:s("metadata.edit.description")})]}),l?e.jsx(te,{}):e.jsx(se,{...a})]})},T="metadata-form-key-label",F="metadata-form-value-label",se=({metadata:t,hook:s,isMutating:l})=>{const{t:a}=O(),{handleSuccess:u}=Y(),i=ie(t),r=L({defaultValues:{metadata:le(t)},resolver:z(ae)}),j=r.handleSubmit(async n=>{const o=re(n);await s({metadata:o},{onSuccess:()=>{R.success(a("metadata.edit.successToast")),u()},onError:c=>{R.error(c.message)}})}),{fields:f,insert:_,remove:D}=H({control:r.control,name:"metadata"});function P(n){D(n),f.length===1&&_(0,{key:"",value:"",disabled:!1})}function E(n,o){_(n+(o==="above"?0:1),{key:"",value:"",disabled:!1})}return e.jsx(d.Form,{form:r,children:e.jsxs($,{onSubmit:j,className:"flex flex-1 flex-col overflow-hidden",children:[e.jsxs(d.Body,{className:"flex flex-1 flex-col gap-y-8 overflow-y-auto",children:[e.jsxs("div",{className:"bg-ui-bg-base shadow-elevation-card-rest grid grid-cols-1 divide-y rounded-lg",children:[e.jsxs("div",{className:"bg-ui-bg-subtle grid grid-cols-2 divide-x rounded-t-lg",children:[e.jsx("div",{className:"txt-compact-small-plus text-ui-fg-subtle px-2 py-1.5",children:e.jsx("label",{id:T,children:a("metadata.edit.labels.key")})}),e.jsx("div",{className:"txt-compact-small-plus text-ui-fg-subtle px-2 py-1.5",children:e.jsx("label",{id:F,children:a("metadata.edit.labels.value")})})]}),f.map((n,o)=>{const c=n.disabled||!1;let v="-";return typeof n.value=="object"&&(v="{ ... }"),Array.isArray(n.value)&&(v="[ ... ]"),e.jsx(K,{showTooltip:c,content:a("metadata.edit.complexRow.tooltip"),children:e.jsxs("div",{className:"group/table relative",children:[e.jsxs("div",{className:w("grid grid-cols-2 divide-x",{"overflow-hidden rounded-b-lg":o===f.length-1}),children:[e.jsx(x.Field,{control:r.control,name:`metadata.${o}.key`,render:({field:g})=>e.jsx(x.Item,{children:e.jsx(x.Control,{children:e.jsx(N,{"aria-labelledby":T,...g,disabled:c,placeholder:"Key"})})})}),e.jsx(x.Field,{control:r.control,name:`metadata.${o}.value`,render:({field:{value:g,...B}})=>e.jsx(x.Item,{children:e.jsx(x.Control,{children:e.jsx(N,{"aria-labelledby":F,...B,value:c?v:g,disabled:c,placeholder:"Value"})})})})]}),e.jsxs(m,{children:[e.jsx(m.Trigger,{className:w("invisible absolute inset-y-0 -right-2.5 my-auto group-hover/table:visible data-[state='open']:visible",{hidden:c}),disabled:c,asChild:!0,children:e.jsx(U,{size:"2xsmall",children:e.jsx(S,{})})}),e.jsxs(m.Content,{children:[e.jsxs(m.Item,{className:"gap-x-2",onClick:()=>E(o,"above"),children:[e.jsx(q,{className:"text-ui-fg-subtle"}),a("metadata.edit.actions.insertRowAbove")]}),e.jsxs(m.Item,{className:"gap-x-2",onClick:()=>E(o,"below"),children:[e.jsx(J,{className:"text-ui-fg-subtle"}),a("metadata.edit.actions.insertRowBelow")]}),e.jsx(m.Separator,{}),e.jsxs(m.Item,{className:"gap-x-2",onClick:()=>P(o),children:[e.jsx(Q,{className:"text-ui-fg-subtle"}),a("metadata.edit.actions.deleteRow")]})]})]})]})},n.id)})]}),i&&e.jsx(G,{variant:"warning",label:a("metadata.edit.complexRow.label"),children:a("metadata.edit.complexRow.description")})]}),e.jsx(d.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(d.Close,{asChild:!0,children:e.jsx(A,{size:"small",variant:"secondary",type:"button",disabled:l,children:a("actions.cancel")})}),e.jsx(A,{size:"small",type:"submit",isLoading:l,children:a("actions.save")})]})})]})})},N=b.forwardRef(({className:t,...s},l)=>e.jsx("input",{ref:l,...s,autoComplete:"off",className:w("txt-compact-small text-ui-fg-base placeholder:text-ui-fg-muted disabled:text-ui-fg-disabled disabled:bg-ui-bg-base bg-transparent px-2 py-1.5 outline-none",t)}));N.displayName="MetadataForm.GridInput";var te=()=>e.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden",children:[e.jsx(d.Body,{children:e.jsx(y,{className:"h-[148ox] w-full rounded-lg"})}),e.jsx(d.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(y,{className:"h-7 w-12 rounded-md"}),e.jsx(y,{className:"h-7 w-12 rounded-md"})]})})]}),k=["string","number","boolean"];function le(t){return!t||!Object.keys(t).length?[{key:"",value:"",disabled:!1}]:Object.entries(t).map(([s,l])=>{if(!k.includes(typeof l))return{key:s,value:l,disabled:!0};let a=l;return typeof l!="string"&&(a=JSON.stringify(l)),{key:s,value:a,original_key:s}})}function re(t){const s=t.metadata;if(!s.length||s.length===1&&!s[0].key&&!s[0].value)return null;const a={};return s.forEach(u=>{let i=u.key,r=u.value;const j=u.disabled;if(!(!i||!r)){if(j){a[i]=r;return}if(i=i.trim(),r=r.trim(),r==="true")a[i]=!0;else if(r==="false")a[i]=!1;else{const f=parseFloat(r);isNaN(f)?a[i]=r:a[i]=f}}}),a}function ie(t){return t?Object.values(t).some(s=>!k.includes(typeof s)):!1}export{me as M};
