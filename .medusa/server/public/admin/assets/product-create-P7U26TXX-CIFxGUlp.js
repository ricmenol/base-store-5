import{C as oe}from"./chunk-X5VECN6S-DN2u_lOC.js";import{H as qe}from"./chunk-7OYLCEKK-C92UdZpX.js";import{u as Re,a as Be,b as He,c as Le}from"./chunk-6TVXQXDC-LzWoQShG.js";import{C as Ke}from"./chunk-CLOHNZKZ-B_yZbaVB.js";import{u as G}from"./chunk-6CNRNROJ-Cvp6AfPW.js";import{C as U}from"./chunk-W6N53UNG-BUeeAVFO.js";import{P as Ge,a as Ue,n as We,U as Xe,d as ce}from"./chunk-HP4JZCP4-CAlNV33w.js";import{u as xe,a as J,D as fe,S as ge,b as ve,c as je,C as be,s as ye,K as Ce,P as Ne,d as _e,e as we}from"./sortable.esm-C0qhePiI.js";import"./chunk-ZQRKUG6J-CMLA3Mcx.js";import{D as A,c as Ze,a as Je}from"./chunk-GE4APTT2-DwZqUMYj.js";import{C as Qe}from"./chunk-XDJ7OMBR-LbV69exI.js";import{r as w,b as I,g as Ye,h as et,i as tt,l as st,j as e,m as Se,I as B,a as ie,n as at,o as rt,v as R,s as q,t as se,B as F,F as Pe,D as nt,H as ee,w as l,x as Q,y as L,T as K,A as Ve,X as ke,z as X,C as it,E as lt,G as ot,J as ct,k as dt}from"./index-DkzW1lbC.js";import{D as ut,c as mt}from"./chunk-FPVDKY3X-DRU-UCu7.js";import{S as De}from"./chunk-CBJWO6K6-SUuqZ14f.js";import{K as pt}from"./chunk-6HTZNHPT-BAw8hsS0.js";import{R as O,u as Ie,S as $,a as ht}from"./chunk-AYRG2MQL-p8d_KfEl.js";import{D as le}from"./dots-six-BeE1_mvb.js";import{P as T}from"./progress-tabs-2zcWJOpy.js";import{T as xt}from"./textarea-D3MiPwdl.js";import{T as ze}from"./thumbnail-badge-2kwfZ9B-.js";import{T as ft}from"./trash-DsE5_8XG.js";import{A as ae}from"./alert-C_-GYZd7.js";import{X as Ee}from"./x-mark-mini-bZP8SCsT.js";import{T as de}from"./Trans-kjzLiaOB.js";import{C as ue}from"./checkbox-meFL0Q5O.js";import"./chunk-JGKUKVRC-96n9KjXI.js";import"./chunk-BKWQ2FHJ-QjmO9jF9.js";import"./format-ncaUJPf-.js";import"./chunk-C76H5USB-C8KApNCG.js";import"./triangles-mini-7BXnDNsU.js";import"./index-CrLI-CUR.js";import"./plus-mini-CrzVgHGc.js";import"./chunk-TYTNUPXB-B381cDig.js";import"./chunk-6GU6IDUA-CDc7wW5L.js";import"./chunk-MWVM4TYO-bKUcYSnf.js";import"./_isIndex-BVwmq6o4.js";import"./index.esm-BErPA2tB.js";import"./index-C80j_Nkx.js";import"./command-bar-CzjD0zPo.js";import"./table-yxlhz450.js";import"./arrow-up-mini-U4e2cj7E.js";import"./date-picker-q6BpD6Yt.js";import"./popover-CkT8s_eK.js";import"./triangle-left-mini-C63wDOBG.js";import"./prompt-PHMJs5xL.js";var gt=Object.defineProperty,Y=Object.getOwnPropertySymbols,Te=Object.prototype.hasOwnProperty,Fe=Object.prototype.propertyIsEnumerable,me=(t,s,a)=>s in t?gt(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a,vt=(t,s)=>{for(var a in s)Te.call(s,a)&&me(t,a,s[a]);if(Y)for(var a of Y(s))Fe.call(s,a)&&me(t,a,s[a]);return t},jt=(t,s)=>{var a={};for(var n in t)Te.call(t,n)&&s.indexOf(n)<0&&(a[n]=t[n]);if(t!=null&&Y)for(var n of Y(t))s.indexOf(n)<0&&Fe.call(t,n)&&(a[n]=t[n]);return a};const Me=w.forwardRef((t,s)=>{var a=t,{color:n="currentColor"}=a,i=jt(a,["color"]);return w.createElement("svg",vt({xmlns:"http://www.w3.org/2000/svg",width:15,height:15,fill:"none",ref:s},i),w.createElement("path",{stroke:n,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"m2.389 10.389-.748.25a.444.444 0 0 1-.585-.422V4.783c0-.303.297-.517.585-.421l.748.25M5.944 12.055l-.718.3a.445.445 0 0 1-.615-.41v-8.89c0-.317.323-.532.615-.41l.718.3M8.798 1.124l4.631 2.137c.315.145.516.46.516.807v6.862a.89.89 0 0 1-.516.807l-4.631 2.137a.445.445 0 0 1-.631-.403V1.528c0-.325.336-.54.63-.404"}))});Me.displayName="StackPerspective";var bt=({form:t})=>{const{t:s}=I();return e.jsxs("div",{id:"general",className:"flex flex-col gap-y-6",children:[e.jsx("div",{className:"flex flex-col gap-y-2",children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[e.jsx(l.Field,{control:t.control,name:"title",render:({field:a})=>e.jsxs(l.Item,{children:[e.jsx(l.Label,{children:s("products.fields.title.label")}),e.jsx(l.Control,{children:e.jsx(Q,{...a,placeholder:"Winter jacket"})})]})}),e.jsx(l.Field,{control:t.control,name:"subtitle",render:({field:a})=>e.jsxs(l.Item,{children:[e.jsx(l.Label,{optional:!0,children:s("products.fields.subtitle.label")}),e.jsx(l.Control,{children:e.jsx(Q,{...a,placeholder:"Warm and cosy"})})]})}),e.jsx(l.Field,{control:t.control,name:"handle",render:({field:a})=>e.jsxs(l.Item,{children:[e.jsx(l.Label,{tooltip:s("products.fields.handle.tooltip"),optional:!0,children:s("fields.handle")}),e.jsx(l.Control,{children:e.jsx(qe,{...a,placeholder:"winter-jacket"})})]})})]})}),e.jsx(l.Field,{control:t.control,name:"description",render:({field:a})=>e.jsxs(l.Item,{children:[e.jsx(l.Label,{optional:!0,children:s("products.fields.description.label")}),e.jsx(l.Control,{children:e.jsx(xt,{...a,placeholder:"A warm and cozy jacket"})})]})})]})},yt={sideEffects:we({styles:{active:{opacity:"0.4"}}})},Ct=({form:t})=>{const{fields:s,append:a,remove:n}=L({name:"media",control:t.control,keyName:"field_id"}),[i,r]=w.useState(null),u=xe(J(Ne),J(Ce,{coordinateGetter:ye})),v=f=>{r(f.active.id)},m=f=>{r(null);const{active:S,over:N}=f;if(S.id!==(N==null?void 0:N.id)){const V=s.findIndex(g=>g.field_id===S.id),D=s.findIndex(g=>g.field_id===(N==null?void 0:N.id));t.setValue("media",_e(s,V,D),{shouldDirty:!0,shouldTouch:!0})}},p=()=>{r(null)},o=f=>()=>{n(f)},d=f=>()=>{const S=s.map((N,V)=>({...N,isThumbnail:V===f}));t.setValue("media",S,{shouldDirty:!0,shouldTouch:!0})},x=f=>({onDelete:o(f),onMakeThumbnail:d(f)});return e.jsxs("div",{id:"media",className:"flex flex-col gap-y-2",children:[e.jsx(Xe,{form:t,append:a,showHint:!1}),e.jsxs(fe,{sensors:u,onDragEnd:m,onDragStart:v,onDragCancel:p,children:[e.jsx(ve,{dropAnimation:yt,children:i?e.jsx(_t,{field:s.find(f=>f.field_id===i)}):null}),e.jsx("ul",{className:"flex flex-col gap-y-2",children:e.jsx(ge,{items:s.map(f=>f.field_id),children:s.map((f,S)=>{const{onDelete:N,onMakeThumbnail:V}=x(S);return e.jsx(Nt,{field:f,onDelete:N,onMakeThumbnail:V},f.field_id)})})})]})]})},Nt=({field:t,onDelete:s,onMakeThumbnail:a})=>{const{t:n}=I(),{attributes:i,listeners:r,setNodeRef:u,setActivatorNodeRef:v,transform:m,transition:p,isDragging:o}=je({id:t.field_id}),d={opacity:o?.4:void 0,transform:be.Translate.toString(m),transition:p};return t.file?e.jsxs("li",{className:"bg-ui-bg-component shadow-elevation-card-rest flex items-center justify-between rounded-lg px-3 py-2",ref:u,style:d,children:[e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsx(B,{variant:"transparent",type:"button",size:"small",...i,...r,ref:v,className:"cursor-grab touch-none active:cursor-grabbing",children:e.jsx(le,{className:"text-ui-fg-muted"})}),e.jsxs("div",{className:"flex items-center gap-x-3",children:[e.jsx("div",{className:"bg-ui-bg-base h-10 w-[30px] overflow-hidden rounded-md",children:e.jsx(Oe,{url:t.url})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(K,{size:"small",leading:"compact",children:t.file.name}),e.jsxs("div",{className:"flex items-center gap-x-1",children:[t.isThumbnail&&e.jsx(ze,{}),e.jsx(K,{size:"xsmall",leading:"compact",className:"text-ui-fg-subtle",children:Ae(t.file.size)})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-x-1",children:[e.jsx(Ve,{groups:[{actions:[{label:n("products.media.makeThumbnail"),icon:e.jsx(Me,{}),onClick:a}]},{actions:[{icon:e.jsx(ft,{}),label:n("actions.delete"),onClick:s}]}]}),e.jsx(B,{type:"button",size:"small",variant:"transparent",onClick:s,children:e.jsx(ke,{})})]})]}):null},_t=({field:t})=>{var s,a;return e.jsxs("li",{className:"bg-ui-bg-component shadow-elevation-card-rest flex items-center justify-between rounded-lg px-3 py-2",children:[e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsx(B,{variant:"transparent",size:"small",className:"cursor-grab touch-none active:cursor-grabbing",children:e.jsx(le,{className:"text-ui-fg-muted"})}),e.jsxs("div",{className:"flex items-center gap-x-3",children:[e.jsx("div",{className:"bg-ui-bg-base h-10 w-[30px] overflow-hidden rounded-md",children:e.jsx(Oe,{url:t.url})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(K,{size:"small",leading:"compact",children:(s=t.file)==null?void 0:s.name}),e.jsxs("div",{className:"flex items-center gap-x-1",children:[t.isThumbnail&&e.jsx(ze,{}),e.jsx(K,{size:"xsmall",leading:"compact",className:"text-ui-fg-subtle",children:Ae(((a=t.file)==null?void 0:a.size)??0)})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-x-1",children:[e.jsx(Ve,{groups:[]}),e.jsx(B,{type:"button",size:"small",variant:"transparent",onClick:()=>{},children:e.jsx(ke,{})})]})]})},Oe=({url:t})=>t?e.jsx("img",{src:t,alt:"",className:"size-full object-cover object-center"}):null;function Ae(t,s=2){if(t===0)return"0 Bytes";const a=1024,n=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],i=Math.floor(Math.log(t)/Math.log(a));return parseFloat((t/Math.pow(a,i)).toFixed(s))+" "+n[i]}var wt=({items:t,onChange:s,renderItem:a})=>{const[n,i]=w.useState(null),[r,u]=w.useMemo(()=>{if(n===null)return[null,null];const d=t.findIndex(({id:x})=>x===n.id);return[t[d],d]},[n,t]),v=xe(J(Ne),J(Ce,{coordinateGetter:ye})),m=({active:d})=>{i(d)},p=({active:d,over:x})=>{if(x&&d.id!==x.id){const f=t.findIndex(({id:N})=>N===d.id),S=t.findIndex(({id:N})=>N===x.id);s(_e(t,f,S))}i(null)},o=()=>{i(null)};return e.jsxs(fe,{sensors:v,onDragStart:m,onDragEnd:p,onDragCancel:o,children:[e.jsx(Pt,{children:r&&u!==null?a(r,u):null}),e.jsx(ge,{items:t,children:e.jsx("ul",{role:"application",className:"flex list-inside list-none list-image-none flex-col p-0",children:t.map((d,x)=>e.jsx(w.Fragment,{children:a(d,x)},d.id))})})]})},St={sideEffects:we({styles:{active:{opacity:"0.4"}}})},Pt=({children:t})=>e.jsx(ve,{className:"shadow-elevation-card-hover overflow-hidden rounded-md [&>li]:border-b-0",dropAnimation:St,children:t}),$e=w.createContext(null),Vt=()=>{const t=w.useContext($e);if(!t)throw new Error("useSortableItemContext must be used within a SortableItemContext");return t},kt=({id:t,className:s,children:a})=>{const{attributes:n,isDragging:i,listeners:r,setNodeRef:u,setActivatorNodeRef:v,transform:m,transition:p}=je({id:t}),o=w.useMemo(()=>({attributes:n,listeners:r,ref:v,isDragging:i}),[n,r,v,i]),d={opacity:i?.4:void 0,transform:be.Translate.toString(m),transition:p};return e.jsx($e.Provider,{value:o,children:e.jsx("li",{className:Se("transition-fg flex flex-1 list-none",s),ref:u,style:d,children:a})})},Dt=()=>{const{attributes:t,listeners:s,ref:a}=Vt();return e.jsx(B,{variant:"transparent",size:"small",...t,...s,ref:a,className:"cursor-grab touch-none active:cursor-grabbing",children:e.jsx(le,{className:"text-ui-fg-muted"})})},re=Object.assign(wt,{Item:kt,DragHandle:Dt}),ne=t=>{if(t.length===0)return[];if(t.length===1)return t[0].values.map(n=>({[t[0].title]:n}));const s=t[0],a=t.slice(1);return s.values.flatMap(n=>ne(a).map(i=>({[s.title]:n,...i})))},Z=t=>Object.values(t).join(" / "),It=({form:t})=>{var N,V,D;const{t:s}=I(),a=L({control:t.control,name:"options"}),n=L({control:t.control,name:"variants"}),i=R({control:t.control,name:"enable_variants",defaultValue:!1}),r=R({control:t.control,name:"options",defaultValue:[]}),u=R({control:t.control,name:"variants",defaultValue:[]}),v=!!((N=t.formState.errors.options)!=null&&N.length),m=((D=(V=t.formState.errors.variants)==null?void 0:V.root)==null?void 0:D.message)==="invalid_length",p=(g,h)=>{const{isTouched:c}=t.getFieldState("variants"),j=[...r];j[g].values=h;const y=ne(j),_=[...u],E=b=>y.find(M=>Object.keys(b).every(k=>b[k]===M[k])),z=_.reduce((b,M)=>{const k=E(M.options);return k&&b.push({...M,title:Z(k),options:k}),b},[]),C=new Set(z.map(b=>b.options));y.filter(b=>!C.has(b)).forEach(b=>{z.push({title:Z(b),options:b,should_create:!c,variant_rank:z.length,inventory:[{inventory_item_id:"",required_quantity:""}]})}),t.setValue("variants",z)},o=g=>{if(g===0)return;a.remove(g);const h=[...r];h.splice(g,1);const c=ne(h),j=[...u],y=C=>c.find(P=>Object.keys(C).every(b=>C[b]===P[b])),_=j.reduce((C,P)=>{const b=y(P.options);return b&&C.push({...P,title:Z(b),options:b}),C},[]),E=new Set(_.map(C=>C.options));c.filter(C=>!E.has(C)).forEach(C=>{_.push({title:Z(C),options:C,should_create:!1,variant_rank:_.length})}),t.setValue("variants",_)},d=g=>{const h=g.map((c,j)=>{const y=u.find(_=>_.title===c.title);return{id:c.id,...y||c,variant_rank:j}});n.replace(h)},x=g=>g.every(h=>h.should_create)?!0:g.some(h=>h.should_create)?"indeterminate":!1,f=g=>{switch(g){case!0:{const h=u.map(c=>({...c,should_create:!0}));t.setValue("variants",h);break}case!1:{const h=u.map(c=>({...c,should_create:!1}));t.setValue("variants",ce(h));break}}},S=()=>{t.setValue("options",[{title:"Default option",values:["Default option value"]}]),t.setValue("variants",ce([{title:"Default variant",should_create:!0,variant_rank:0,options:{"Default option":"Default option value"},inventory:[{inventory_item_id:"",required_quantity:""}],is_default:!0}]))};return e.jsxs("div",{id:"variants",className:"flex flex-col gap-y-8",children:[e.jsxs("div",{className:"flex flex-col gap-y-6",children:[e.jsx(ee,{level:"h2",children:s("products.create.variants.header")}),e.jsx(De,{control:t.control,name:"enable_variants",label:s("products.create.variants.subHeadingTitle"),description:s("products.create.variants.subHeadingDescription"),onCheckedChange:g=>{g?(t.setValue("options",[{title:"",values:[]}]),t.setValue("variants",[])):S()}})]}),i&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col gap-y-6",children:e.jsx(l.Field,{control:t.control,name:"options",render:()=>e.jsx(l.Item,{children:e.jsxs("div",{className:"flex flex-col gap-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between gap-x-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx(l.Label,{children:s("products.create.variants.productOptions.label")}),e.jsx(l.Hint,{children:s("products.create.variants.productOptions.hint")})]}),e.jsx(F,{size:"small",variant:"secondary",type:"button",onClick:()=>{a.append({title:"",values:[]})},children:s("actions.add")})]}),v&&e.jsx(ae,{dismissible:!0,variant:"error",children:s("products.create.errors.options")}),e.jsx("ul",{className:"flex flex-col gap-y-4",children:a.fields.map((g,h)=>e.jsxs("li",{className:"bg-ui-bg-component shadow-elevation-card-rest grid grid-cols-[1fr_28px] items-center gap-1.5 rounded-xl p-1.5",children:[e.jsxs("div",{className:"grid grid-cols-[min-content,1fr] items-center gap-1.5",children:[e.jsx("div",{className:"flex items-center px-2 py-1.5",children:e.jsx(X,{size:"xsmall",weight:"plus",className:"text-ui-fg-subtle",htmlFor:`options.${h}.title`,children:s("fields.title")})}),e.jsx(Q,{className:"bg-ui-bg-field-component hover:bg-ui-bg-field-component-hover",...t.register(`options.${h}.title`),placeholder:s("products.fields.options.optionTitlePlaceholder")}),e.jsx("div",{className:"flex items-center px-2 py-1.5",children:e.jsx(X,{size:"xsmall",weight:"plus",className:"text-ui-fg-subtle",htmlFor:`options.${h}.values`,children:s("fields.values")})}),e.jsx(it,{control:t.control,name:`options.${h}.values`,render:({field:{onChange:c,...j}})=>{const y=_=>{p(h,_),c(_)};return e.jsx(Qe,{...j,variant:"contrast",onChange:y,placeholder:s("products.fields.options.variantionsPlaceholder")})}})]}),e.jsx(B,{type:"button",size:"small",variant:"transparent",className:"text-ui-fg-muted",disabled:h===0,onClick:()=>o(h),children:e.jsx(Ee,{})})]},g.id))})]})})})}),e.jsx("div",{className:"grid grid-cols-1 gap-x-4 gap-y-8",children:e.jsxs("div",{className:"flex flex-col gap-y-6",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx(X,{weight:"plus",children:s("products.create.variants.productVariants.label")}),e.jsx(lt,{children:s("products.create.variants.productVariants.hint")})]}),!v&&m&&e.jsx(ae,{dismissible:!0,variant:"error",children:s("products.create.errors.variants")}),n.fields.length>0?e.jsxs("div",{className:"overflow-hidden rounded-xl border",children:[e.jsxs("div",{className:"bg-ui-bg-component text-ui-fg-subtle grid items-center gap-3 border-b px-6 py-2.5",style:{gridTemplateColumns:`20px 28px repeat(${r.length}, 1fr)`},children:[e.jsx("div",{children:e.jsx(ue,{className:"relative",checked:x(u),onCheckedChange:f})}),e.jsx("div",{}),r.map((g,h)=>e.jsx("div",{children:e.jsx(K,{size:"small",leading:"compact",weight:"plus",children:g.title})},h))]}),e.jsx(re,{items:n.fields,onChange:d,renderItem:(g,h)=>e.jsx(re.Item,{id:g.id,className:Se("bg-ui-bg-base border-b",{"border-b-0":h===n.fields.length-1}),children:e.jsxs("div",{className:"text-ui-fg-subtle grid w-full items-center gap-3 px-6 py-2.5",style:{gridTemplateColumns:`20px 28px repeat(${r.length}, 1fr)`},children:[e.jsx(l.Field,{control:t.control,name:`variants.${h}.should_create`,render:({field:{value:c,onChange:j,...y}})=>e.jsx(l.Item,{children:e.jsx(l.Control,{children:e.jsx(ue,{className:"relative",...y,checked:c,onCheckedChange:j})})})}),e.jsx(re.DragHandle,{}),Object.values(g.options).map((c,j)=>e.jsx(K,{size:"small",leading:"compact",children:c},j))]})})})]}):e.jsx(ae,{children:s("products.create.variants.productVariants.alert")}),n.fields.length>0&&e.jsx(ot,{variant:"tip",children:s("products.create.variants.productVariants.tip")})]})})]})]})},zt=({form:t})=>{const{getFormFields:s}=ie(),a=s("product","create","general");return e.jsx("div",{className:"flex flex-col items-center p-16",children:e.jsxs("div",{className:"flex w-full max-w-[720px] flex-col gap-y-8",children:[e.jsx(Et,{}),e.jsxs("div",{className:"flex flex-col gap-y-6",children:[e.jsx(bt,{form:t}),e.jsx(Pe,{fields:a,form:t}),e.jsx(Ct,{form:t})]}),e.jsx(nt,{}),e.jsx(It,{form:t})]})})},Et=()=>{const{t}=I();return e.jsx("div",{className:"flex flex-col",children:e.jsx(ee,{children:t("products.create.header")})})};function Tt({form:t,variant:s,index:a}){const{t:n}=I(),i=L({control:t.control,name:`variants.${a}.inventory`}),r=R({control:t.control,name:`variants.${a}.inventory`}),u=G({queryKey:["inventory_items"],queryFn:m=>q.admin.inventoryItem.list(m),getOptions:m=>m.inventory_items.map(p=>({label:p.title,value:p.id}))}),v=(m,p)=>r==null?void 0:r.some((o,d)=>d!=p&&o.inventory_item_id===m.value);return e.jsxs("div",{className:"grid gap-y-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-x-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx(l.Label,{children:s.title}),e.jsx(l.Hint,{children:n("products.create.inventory.label")})]}),e.jsx(F,{size:"small",variant:"secondary",type:"button",onClick:()=>{i.append({inventory_item_id:"",required_quantity:""})},children:n("actions.add")})]}),i.fields.map((m,p)=>e.jsxs("li",{className:"bg-ui-bg-component shadow-elevation-card-rest grid grid-cols-[1fr_28px] items-center gap-1.5 rounded-xl p-1.5",children:[e.jsxs("div",{className:"grid grid-cols-[min-content,1fr] items-center gap-1.5",children:[e.jsx("div",{className:"flex items-center px-2 py-1.5",children:e.jsx(X,{size:"xsmall",weight:"plus",className:"text-ui-fg-subtle",htmlFor:`variants.${a}.inventory.${p}.inventory_item_id`,children:n("fields.item")})}),e.jsx(l.Field,{control:t.control,name:`variants.${a}.inventory.${p}.inventory_item_id`,render:({field:o})=>e.jsx(l.Item,{children:e.jsx(l.Control,{children:e.jsx(U,{...o,options:u.options.map(d=>({...d,disabled:v(d,p)})),searchValue:u.searchValue,onSearchValueChange:u.onSearchValueChange,fetchNextPage:u.fetchNextPage,className:"bg-ui-bg-field-component hover:bg-ui-bg-field-component-hover",placeholder:n("products.create.inventory.itemPlaceholder")})})})}),e.jsx("div",{className:"flex items-center px-2 py-1.5",children:e.jsx(X,{size:"xsmall",weight:"plus",className:"text-ui-fg-subtle",htmlFor:`variants.${a}.inventory.${p}.required_quantity`,children:n("fields.quantity")})}),e.jsx(l.Field,{control:t.control,name:`variants.${a}.inventory.${p}.required_quantity`,render:({field:{onChange:o,value:d,...x}})=>e.jsxs(l.Item,{children:[e.jsx(l.Control,{children:e.jsx(Q,{type:"number",className:"bg-ui-bg-field-component",min:0,value:d,onChange:f=>{const S=f.target.value;o(S===""?null:Number(S))},...x,placeholder:n("products.create.inventory.quantityPlaceholder")})}),e.jsx(l.ErrorMessage,{})]})})]}),e.jsx(B,{type:"button",size:"small",variant:"transparent",className:"text-ui-fg-muted",onClick:()=>i.remove(p),children:e.jsx(Ee,{})})]},m.id))]})}var Ft=({form:t})=>{const{t:s}=I(),a=L({control:t.control,name:"variants"});return e.jsxs("div",{id:"organize",className:"flex flex-col gap-y-8",children:[e.jsx(ee,{children:s("products.create.inventory.heading")}),a.fields.filter(n=>n.inventory_kit).map((n,i)=>e.jsx(Tt,{form:t,variant:n,index:i},n.id))]})},Mt=({form:t})=>e.jsx("div",{className:"flex flex-col items-center p-16",children:e.jsx("div",{className:"flex w-full max-w-[720px] flex-col gap-y-8",children:e.jsx(Ft,{form:t})})}),Ot=({form:t})=>{const{t:s}=I(),a=G({queryKey:["product_collections"],queryFn:o=>q.admin.productCollection.list(o),getOptions:o=>o.collections.map(d=>({label:d.title,value:d.id}))}),n=G({queryKey:["product_types"],queryFn:o=>q.admin.productType.list(o),getOptions:o=>o.product_types.map(d=>({label:d.value,value:d.id}))}),i=G({queryKey:["product_tags"],queryFn:o=>q.admin.productTag.list(o),getOptions:o=>o.product_tags.map(d=>({label:d.value,value:d.id}))}),r=G({queryKey:["shipping_profiles"],queryFn:o=>q.admin.shippingProfile.list(o),getOptions:o=>o.shipping_profiles.map(d=>({label:d.name,value:d.id}))}),{fields:u,remove:v,replace:m}=L({control:t.control,name:"sales_channels",keyName:"key"}),p=()=>{m([])};return e.jsxs("div",{id:"organize",className:"flex flex-col gap-y-8",children:[e.jsx(ee,{children:s("products.organization.header")}),e.jsx(De,{control:t.control,name:"discountable",label:s("products.fields.discountable.label"),description:s("products.fields.discountable.hint"),optional:!0}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(l.Field,{control:t.control,name:"type_id",render:({field:o})=>e.jsxs(l.Item,{children:[e.jsx(l.Label,{optional:!0,children:s("products.fields.type.label")}),e.jsx(l.Control,{children:e.jsx(U,{...o,options:n.options,searchValue:n.searchValue,onSearchValueChange:n.onSearchValueChange,fetchNextPage:n.fetchNextPage})}),e.jsx(l.ErrorMessage,{})]})}),e.jsx(l.Field,{control:t.control,name:"collection_id",render:({field:o})=>e.jsxs(l.Item,{children:[e.jsx(l.Label,{optional:!0,children:s("products.fields.collection.label")}),e.jsx(l.Control,{children:e.jsx(U,{...o,options:a.options,searchValue:a.searchValue,onSearchValueChange:a.onSearchValueChange,fetchNextPage:a.fetchNextPage})}),e.jsx(l.ErrorMessage,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(l.Field,{control:t.control,name:"categories",render:({field:o})=>e.jsxs(l.Item,{children:[e.jsx(l.Label,{optional:!0,children:s("products.fields.categories.label")}),e.jsx(l.Control,{children:e.jsx(Ke,{...o})}),e.jsx(l.ErrorMessage,{})]})}),e.jsx(l.Field,{control:t.control,name:"tags",render:({field:o})=>e.jsxs(l.Item,{children:[e.jsx(l.Label,{optional:!0,children:s("products.fields.tags.label")}),e.jsx(l.Control,{children:e.jsx(U,{...o,options:i.options,searchValue:i.searchValue,onSearchValueChange:i.onSearchValueChange,fetchNextPage:i.fetchNextPage})}),e.jsx(l.ErrorMessage,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(l.Label,{children:s("products.fields.shipping_profile.label")}),e.jsx(l.Hint,{children:e.jsx(de,{i18nKey:"products.fields.shipping_profile.hint"})})]}),e.jsx(l.Field,{control:t.control,name:"shipping_profile_id",render:({field:o})=>e.jsxs(l.Item,{children:[e.jsx(l.Control,{children:e.jsx(U,{...o,options:r.options,searchValue:r.searchValue,onSearchValueChange:r.onSearchValueChange,fetchNextPage:r.fetchNextPage})}),e.jsx(l.ErrorMessage,{})]})})]}),e.jsx("div",{className:"grid grid-cols-1 gap-y-4",children:e.jsx(l.Field,{control:t.control,name:"sales_channels",render:()=>e.jsxs(l.Item,{children:[e.jsxs("div",{className:"flex items-start justify-between gap-x-4",children:[e.jsxs("div",{children:[e.jsx(l.Label,{optional:!0,children:s("products.fields.sales_channels.label")}),e.jsx(l.Hint,{children:e.jsx(de,{i18nKey:"products.fields.sales_channels.hint"})})]}),e.jsx($.Trigger,{asChild:!0,children:e.jsx(F,{size:"small",variant:"secondary",type:"button",children:s("actions.add")})})]}),e.jsx(l.Control,{className:"mt-0",children:u.length>0&&e.jsx(oe,{onClearAll:p,onRemove:v,className:"py-4",children:u.map((o,d)=>e.jsx(oe.Chip,{index:d,children:o.name},o.key))})})]})})})]})},W="sc",pe=50,At=({form:t})=>{const{t:s}=I(),{getValues:a,setValue:n}=t,{setIsOpen:i,getIsOpen:r}=ht(),[u,v]=w.useState({}),[m,p]=w.useState([]),o=Re({pageSize:pe,prefix:W}),{sales_channels:d,count:x,isLoading:f,isError:S,error:N}=ct(o,{placeholderData:dt}),V=r(W);w.useEffect(()=>{if(!V)return;const y=a("sales_channels");y&&(p(y.map(_=>({id:_.id,name:_.name}))),v(y.reduce((_,E)=>({..._,[E.id]:!0}),{})))},[V,a]);const D=y=>{const _=Object.keys(y),E=new Set(_.filter(C=>y[C]&&!u[C]));let z=[];E.size>0&&(z=(d==null?void 0:d.filter(C=>E.has(C.id)))??[]),p(C=>{const P=C.filter(b=>y[b.id]);return Array.from(new Set([...P,...z]))}),v(y)},g=()=>{n("sales_channels",m,{shouldDirty:!0,shouldTouch:!0}),i(W,!1)},h=Be(),c=qt(),j=He();if(S)throw N;return e.jsxs($.Content,{className:"flex flex-col overflow-hidden",children:[e.jsx($.Header,{}),e.jsx($.Body,{className:"flex-1 overflow-hidden",children:e.jsx(ut,{data:d,columns:c,filters:h,emptyState:j,rowCount:x,pageSize:pe,getRowId:y=>y.id,rowSelection:{state:u,onRowSelectionChange:D},isLoading:f,layout:"fill",prefix:W})}),e.jsx($.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx($.Close,{asChild:!0,children:e.jsx(F,{size:"small",variant:"secondary",type:"button",children:s("actions.cancel")})}),e.jsx(F,{size:"small",onClick:g,type:"button",children:s("actions.save")})]})})]})},$t=mt(),qt=()=>{const t=Le();return w.useMemo(()=>[$t.select(),...t],[t])},Rt=({form:t})=>{const{getFormFields:s}=ie(),a=s("product","create","organize");return e.jsxs($,{id:W,children:[e.jsx("div",{className:"flex flex-col items-center p-16",children:e.jsxs("div",{className:"flex w-full max-w-[720px] flex-col gap-y-8",children:[e.jsx(Ot,{form:t}),e.jsx(Pe,{fields:a,form:t})]})}),e.jsx(At,{form:t})]})},Bt=({form:t,regions:s,store:a,pricePreferences:n})=>{const{setCloseOnEscape:i}=Ie(),r=w.useMemo(()=>{var o;return((o=a==null?void 0:a.supported_currencies)==null?void 0:o.map(d=>d.currency_code))||[]},[a]),u=R({control:t.control,name:"variants",defaultValue:[]}),v=R({control:t.control,name:"options",defaultValue:[]}),m=Ht({options:v,currencies:r,regions:s,pricePreferences:n}),p=w.useMemo(()=>{const o=[];return u.forEach((d,x)=>{d.should_create&&o.push({...d,originalIndex:x})}),o},[u]);return e.jsx("div",{className:"flex size-full flex-col divide-y overflow-hidden",children:e.jsx(A,{columns:m,data:p,state:t,onEditingChange:o=>i(!o)})})},H=Je(),Ht=({options:t,currencies:s=[],regions:a=[],pricePreferences:n=[]})=>{const{t:i}=I();return w.useMemo(()=>[H.column({id:"options",header:()=>e.jsx("div",{className:"flex size-full items-center overflow-hidden",children:e.jsx("span",{className:"truncate",children:t.map(r=>r.title).join(" / ")})}),cell:r=>e.jsx(A.ReadonlyCell,{context:r,children:t.map(u=>r.row.original.options[u.title]).join(" / ")}),disableHiding:!0}),H.column({id:"title",name:i("fields.title"),header:i("fields.title"),field:r=>`variants.${r.row.original.originalIndex}.title`,type:"text",cell:r=>e.jsx(A.TextCell,{context:r})}),H.column({id:"sku",name:i("fields.sku"),header:i("fields.sku"),field:r=>`variants.${r.row.original.originalIndex}.sku`,type:"text",cell:r=>e.jsx(A.TextCell,{context:r})}),H.column({id:"manage_inventory",name:i("fields.managedInventory"),header:i("fields.managedInventory"),field:r=>`variants.${r.row.original.originalIndex}.manage_inventory`,type:"boolean",cell:r=>e.jsx(A.BooleanCell,{context:r})}),H.column({id:"allow_backorder",name:i("fields.allowBackorder"),header:i("fields.allowBackorder"),field:r=>`variants.${r.row.original.originalIndex}.allow_backorder`,type:"boolean",cell:r=>e.jsx(A.BooleanCell,{context:r})}),H.column({id:"inventory_kit",name:i("fields.inventoryKit"),header:i("fields.inventoryKit"),field:r=>`variants.${r.row.original.originalIndex}.inventory_kit`,type:"boolean",cell:r=>e.jsx(A.BooleanCell,{context:r,disabled:!r.row.original.manage_inventory})}),...Ze({currencies:s,regions:a,pricePreferences:n,getFieldName:(r,u)=>{var v;return(v=r.column.id)!=null&&v.startsWith("currency_prices")?`variants.${r.row.original.originalIndex}.prices.${u}`:`variants.${r.row.original.originalIndex}.prices.${u}`},t:i})],[s,a,t,n,i])},he="save-draft-button",Lt=({defaultChannel:t,regions:s,store:a,pricePreferences:n})=>{const[i,r]=w.useState("details"),[u,v]=w.useState({details:"in-progress",organize:"not-started",variants:"not-started",inventory:"not-started"}),{t:m}=I(),{handleSuccess:p}=Ie(),{getFormConfigs:o}=ie(),d=o("product","create"),x=at({defaultValues:{...Ge,sales_channels:t?[{id:t.id,name:t.name}]:[]},schema:Ue,configs:d}),{mutateAsync:f,isPending:S}=rt(),N=w.useMemo(()=>s!=null&&s.length?s.reduce((c,j)=>(c[j.id]=j.currency_code,c),{}):{},[s]),V=R({control:x.control,name:"variants"}),D=w.useMemo(()=>V.some(c=>c.manage_inventory&&c.inventory_kit),[V]),g=x.handleSubmit(async(c,j)=>{var C;let y=!1;(j==null?void 0:j.nativeEvent)instanceof SubmitEvent&&(y=((C=j==null?void 0:j.nativeEvent)==null?void 0:C.submitter).dataset.name===he);const _=c.media||[],E={...c,media:void 0};let z=[];try{if(_.length){const P=_.find(k=>k.isThumbnail),b=_.filter(k=>!k.isThumbnail),M=[];P&&M.push(q.admin.upload.create({files:[P.file]}).then(k=>k.files.map(te=>({...te,isThumbnail:!0})))),b!=null&&b.length&&M.push(q.admin.upload.create({files:b.map(k=>k.file)}).then(k=>k.files.map(te=>({...te,isThumbnail:!1})))),z=(await Promise.all(M)).flat()}}catch(P){P instanceof Error&&se.error(P.message)}await f(We({...E,media:z,status:y?"draft":"published",regionsCurrencyMap:N}),{onSuccess:P=>{se.success(m("products.create.successToast",{title:P.product.title})),p(`../${P.product.id}`)},onError:P=>{se.error(P.message)}})}),h=async c=>{if(await x.trigger()){if(c==="details"&&r("organize"),c==="organize"){if(!x.getValues("shipping_profile_id")){x.setError("shipping_profile_id",{type:"required",message:m("products.shippingProfile.create.errors.required")});return}r("variants")}c==="variants"&&r("inventory")}};return w.useEffect(()=>{const c={...u};i==="details"&&(c.details="in-progress"),i==="organize"&&(c.details="completed",c.organize="in-progress"),i==="variants"&&(c.details="completed",c.organize="completed",c.variants="in-progress"),i==="inventory"&&(c.details="completed",c.organize="completed",c.variants="completed",c.inventory="in-progress"),v({...c})},[i]),e.jsx(O.Form,{form:x,children:e.jsxs(pt,{onKeyDown:c=>{if(c.key==="Enter"&&(c.preventDefault(),c.metaKey||c.ctrlKey)){if(i!=="variants"){c.preventDefault(),c.stopPropagation(),h(i);return}g()}},onSubmit:g,className:"flex h-full flex-col",children:[e.jsxs(T,{value:i,onValueChange:async c=>{await x.trigger()&&r(c)},className:"flex h-full flex-col overflow-hidden",children:[e.jsx(O.Header,{children:e.jsx("div",{className:"-my-2 w-full border-l",children:e.jsxs(T.List,{className:"justify-start-start flex w-full items-center",children:[e.jsx(T.Trigger,{status:u.details,value:"details",className:"max-w-[200px] truncate",children:m("products.create.tabs.details")}),e.jsx(T.Trigger,{status:u.organize,value:"organize",className:"max-w-[200px] truncate",children:m("products.create.tabs.organize")}),e.jsx(T.Trigger,{status:u.variants,value:"variants",className:"max-w-[200px] truncate",children:m("products.create.tabs.variants")}),D&&e.jsx(T.Trigger,{status:u.inventory,value:"inventory",className:"max-w-[200px] truncate",children:m("products.create.tabs.inventory")})]})})}),e.jsxs(O.Body,{className:"size-full overflow-hidden",children:[e.jsx(T.Content,{className:"size-full overflow-y-auto",value:"details",children:e.jsx(zt,{form:x})}),e.jsx(T.Content,{className:"size-full overflow-y-auto",value:"organize",children:e.jsx(Rt,{form:x})}),e.jsx(T.Content,{className:"size-full overflow-y-auto",value:"variants",children:e.jsx(Bt,{form:x,store:a,regions:s,pricePreferences:n})}),D&&e.jsx(T.Content,{className:"size-full overflow-y-auto",value:"inventory",children:e.jsx(Mt,{form:x})})]})]}),e.jsx(O.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(O.Close,{asChild:!0,children:e.jsx(F,{variant:"secondary",size:"small",children:m("actions.cancel")})}),e.jsx(F,{"data-name":he,size:"small",type:"submit",isLoading:S,className:"whitespace-nowrap",children:m("actions.saveAsDraft")}),e.jsx(Kt,{tab:i,next:h,isLoading:S,showInventoryTab:D})]})})]})})},Kt=({tab:t,next:s,isLoading:a,showInventoryTab:n})=>{const{t:i}=I();return t==="variants"&&!n||t==="inventory"&&n?e.jsx(F,{"data-name":"publish-button",type:"submit",variant:"primary",size:"small",isLoading:a,children:i("actions.publish")},"submit-button"):e.jsx(F,{type:"button",variant:"primary",size:"small",onClick:()=>s(t),children:i("actions.continue")},"next-button")},Os=()=>{const{t}=I(),{store:s,isPending:a,isError:n,error:i}=Ye({fields:"+default_sales_channel"}),{sales_channel:r,isPending:u,isError:v,error:m}=et(s==null?void 0:s.default_sales_channel_id,{enabled:!!(s!=null&&s.default_sales_channel_id)}),{regions:p,isPending:o,isError:d,error:x}=tt({limit:9999}),{price_preferences:f,isPending:S,isError:N,error:V}=st({limit:9999}),D=!!s&&!a&&!!p&&!o&&!!r&&!u&&!!f&&!S;if(n)throw i;if(d)throw x;if(v)throw m;if(N)throw V;return e.jsxs(O,{children:[e.jsx(O.Title,{asChild:!0,children:e.jsx("span",{className:"sr-only",children:t("products.create.title")})}),e.jsx(O.Description,{asChild:!0,children:e.jsx("span",{className:"sr-only",children:t("products.create.description")})}),D&&e.jsx(Lt,{defaultChannel:r,store:s,pricePreferences:f,regions:p})]})};export{Os as Component};
